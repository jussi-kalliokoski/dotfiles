# If not in interactive mode, bail.
[[ $- != *i* ]] && return

# UTF-8, otherwise iTerm2 and vim will act up on unicode characters.
export LANG="en_US.UTF-8"

# Returns "*" if the branch is dirty, or empty if clean
git_is_dirty(){
	[[ $(git status 2>/dev/null | tail -n1) != "nothing to commit, working directory clean" ]] && echo "*"
}

# Returns your git branch and whether it's dirty, e.g. "master *" or "my-clean-branch"
git_prompt_info(){
	git branch --no-color 2>/dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/git:(\1$(git_is_dirty))/"
}

# Returns the battery level, in a format like this: "92.4%". (On Linux, no decimals)
battery_level(){
	BATTERY__LEVEL="?"
	# check if we have acpi (linux)
	command -v acpi >/dev/null 2>&1
	if [[ $? -ne 0 ]]; then
		# if not, we'll try the getting the battery state from ioreg on OS X
		BATTERY__LEVEL=$(ioreg -n AppleSmartBattery -r 2>/dev/null | awk '$1~/Capacity/{c[$1]=$3} END{OFMT="%.2f%%"; max=c["\"MaxCapacity\""]; print (max>0? 100*c["\"CurrentCapacity\""]/max: "?")}')
	else
		BATTERY__LEVEL=$(acpi -b 2>/dev/null | tail -n1 | grep --color=never -o "[0-9][0-9]*%")
	fi
	echo $BATTERY__LEVEL
}

# Can't remember what this does
shopt -s histappend
# Ignore duplicates and empty items in history
export HISTCONTROL="ignoreboth"
# A few improvements to less, most importantly exit at end
export LESS="-EQRX"
# This one is fairly obvious
export EDITOR="vim"

# Set up the prompt
export PS1="\e[1;34m[\e[1;32m\u\e[00m\e[1;30m@\e[0;36m\h\e[1;34m]\e[00m - \e[1;34m[\e[1;37m\w\e[1;34m]\e[00m - \e[1;34m[\e[0;33m\D{%Y/%m/%d %H:%M} :: \$(battery_level)\e[1;34m]\n[\e[1;35m\$\e[1;34m] <\$(git_prompt_info)>\e[00m "

# Enable colors in ls
alias ls="ls -G"
